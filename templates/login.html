<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iDr-Login</title>
    <link rel="icon" href="{{ url_for('static', filename='assets/logo.png')}}">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-0 m-0 bg-white">
    <main class="flex flex-col items-center mt-10 sm:mt-20 px-4">
        <section class="flex flex-col items-center justify-center rounded-l-[10px] gap-[20px] w-full max-w-[600px]">
            <img src="{{ url_for('static', filename='assets/logo.png')}}" class="h-[150px] w-[150px] sm:h-[200px] sm:w-[200px]" alt="">
            
            <!-- Login container -->
            <div class="flex flex-col items-center justify-center rounded-[10px] shadow-md w-full sm:w-[600px] h-auto sm:h-[500px] p-6 sm:p-0">
                <h2 class="text-blue-500 font-mono font-bold text-[24px] sm:text-[30px] pb-[30px] sm:pb-[50px]">Login</h2>

                <!-- Formulário -->
                <form action="/" id="loginForm" class="flex flex-col items-center justify-center gap-[15px] sm:gap-[20px] w-full">
                    <input type="text" placeholder="Digite seu email de cadastro" name="email"
                        class="w-full sm:w-[400px] p-[10px] shadow-md rounded-[10px]" required>

                    <input type="password" placeholder="Digite sua senha" name="password"
                        class="w-full sm:w-[400px] p-[10px] shadow-md rounded-[10px]" required>

                    <button type="submit"
                        class="w-full sm:w-[400px] bg-blue-500 rounded text-white font-bold p-[10px]">Login</button>
                    
                    <!-- Mensagem de verificação -->
                    <p id="verificationMessage" class="font-bold text-red-600 text-[16px] sm:text-[20px]"></p>

                    <!-- Links de cadastro e recuperação -->
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-[20px] sm:gap-[100px] mt-4 sm:mt-0">
                        <a href="/signup"
                            class="border-2 p-[10px] border-blue-600 rounded-[10px] text-blue-600 font-bold w-full sm:w-auto text-center">Cadastrar-se</a>
                        <a href="/forgotpass" class="font-bold text-blue-600">Esqueceu sua senha?</a>
                    </div>
                </form>
            </div>
        </section>
    </main>
</body>
</html>

<script>
    
  // ------------ Login AJAX ---------------------

    const loginForm = document.getElementById('loginForm');
    const verificationMessage = document.getElementById('verificationMessage');
    const loginButton = loginForm.querySelector('button[type="submit"]');

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault(); // Prevines comportamento padrão do form

    // Desabilita botão para evitar múltiplos envios
        loginButton.disabled = true;
        verificationMessage.textContent = '';
        verificationMessage.style.color = 'black';

        const formData = new FormData(loginForm);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('/', {
                method: 'POST',
                body: new URLSearchParams(data),
            });

            const result = await response.json();

            if (result.status === 'success') {
                verificationMessage.textContent = 'Login bem-sucedido! Redirecionando...';
                verificationMessage.style.color = 'green';
            // Pequeno delay antes de redirecionar
                setTimeout(() => {
                    window.location.href = '/main';
                }, 800);
            } else {
                // Caso de erro
                verificationMessage.textContent = result.message || 'Falha no login';
                verificationMessage.style.color = 'red';
            }
        } catch (err) {
            console.error('Erro no fetch:', err);
            verificationMessage.textContent = 'Erro ao tentar se conectar ao servidor.';
            verificationMessage.style.color = 'red';
        } finally {
            // Reativa o botão
            loginButton.disabled = false;
        }
    });
</script>
</html>