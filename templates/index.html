<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iDr-Login</title>
    <link rel="icon" href="{{ url_for('static', filename='assets/logo.png')}}">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-0 m-0 bg-white">
    <main class="flex flex-col items-center justify-center mt-[100px]">
        <img src="{{ url_for('static', filename='assets/logo.png') }}" alt="" class="h-[200px] h-[200px]">
        <section class="w-[400px] h-[450px] flex flex-col items-center border-2 justify-center bg-white p-[20px] gap-[30px] border-2 shadow-md rounded-[10px]">
            <h2 class="text-blue-600 font-bold text-[25px]">Login</h2>
            <form action="{{ url_for('login') }}" method="POST" id="loginForm">
                <input type="text" name="email" placeholder="Insira seu e-mail por gentileza" class="border border-blue-600 p-2 mb-2 w-full shadow-md" required>
                <input type="password" name="password" placeholder="Senha de acesso" class="border border-blue-600 p-2 mb-2 w-full shadow-md" required>
                <button type="submit" class="bg-blue-600 text-white p-2 w-full">Login</button>
                <!-- Displaying verification message -->
                <p class="font-bold text-red-600 text-[20px]" id="verificationMessage"></p>
            </form>
            <div class="flex flex-row items-center justify-center gap-[20px]">
                <a href="/signup" class="border-2 p-[10px] bg-white rounded-[10px] border-blue-600 text-blue-600 font-bold">Cadastrar-se</a>
                <a href="/forgotpass" class="font-bold text-blue-600">Esqueceu sua senha?</a>
            </div>
        </section>
    </main>
</body>

<script>
    
    // ------------ Entering in the application ---------------------

    const loginForm = document.getElementById('loginForm')
    const verificationMessage = document.getElementById('verificationMessage')

    loginForm.addEventListener('submit', async e => {
        e.preventDefault() // Preventing unexpected behavior 

        const form = new FormData(loginForm)
        const data = Object.fromEntries(form.entries())

        try{

            const response = await fetch('/', {
                method : 'POST',
                body : new URLSearchParams(data)
            })

            const result = await response.json()

            // Making the if statement in case that the user could not be found
            
            if(result.status === 'error'){
                // Now updating the HTML element
                verificationMessage.textContent = result.message
            }
            else if ( result.status === 'success'){
                setTimeout(() => {
                    window.location.href = '/main'
                }, 1000);
            }
            
        }catch(err){
            console.log(err);
            verificationMessage.textContent = 'Erro ao encontrar sua conta'
        }
    })

</script>
</html>